<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FinTrack – Signing in…</title>
  <style>
    body { font-family: system-ui, sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background: #f3f4f6; }
    .box { text-align: center; padding: 2rem; }
    .spinner { width: 40px; height: 40px; border: 3px solid #e5e7eb; border-top-color: #6366f1; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 1rem; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .error { color: #b91c1c; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="box">
    <div class="spinner" id="spinner"></div>
    <p id="msg">Opening FinTrack…</p>
    <p class="error" id="err" style="display:none"></p>
  </div>
  <script>
    (function () {
      var hash = window.location.hash && window.location.hash.slice(1)
      var query = window.location.search && window.location.search.slice(1)
      // Supabase PKCE flow sends ?code=... in the query; older/implicit flow sends #access_token=... in the hash
      var params = new URLSearchParams(hash || query)
      var code = params.get('code')
      var access_token = params.get('access_token')
      var refresh_token = params.get('refresh_token')
      var error = params.get('error_description') || params.get('error')

      if (error) {
        document.getElementById('msg').textContent = 'Sign-in failed.'
        document.getElementById('err').textContent = error
        document.getElementById('err').style.display = 'block'
        document.getElementById('spinner').style.display = 'none'
        return
      }

      if (code) {
        var appUrl = 'com.fintrack.app://auth?code=' + encodeURIComponent(code)
        window.location.replace(appUrl)
        return
      }
      if (access_token && refresh_token) {
        var q = new URLSearchParams()
        params.forEach(function (v, k) { q.set(k, v) })
        window.location.replace('com.fintrack.app://auth?' + q.toString())
        return
      }

      document.getElementById('msg').textContent = 'No auth data received. You can close this tab.'
      document.getElementById('spinner').style.display = 'none'
    })()
  </script>
</body>
</html>
